## ralph-claude-code问题

1. loop context只传500个字符，这是否合适？
2. cleanup 的时候，清理了session，这是否合适？
    所有未运行完成的情况，在停止程序之前都调用了 reset_session 是否合适？
3. local files_changed=$(git diff --name-only 2>/dev/null | wc -l || echo 0) 
    这意味着每次循环都要提交代码，下次循环才能监控到本次循环的改动，这是否合适？
4. 这个错误信息检查逻辑是否合适？我感觉应该更加精准的匹配错误信息吧？
    ```shell
    if grep -v '"[^"]*error[^"]*":' "$output_file" 2>/dev/null | \
           grep -qE '(^Error:|^ERROR:|^error:|\]: error|Link: error|Error occurred|failed with error|[Ee]xception|Fatal|FATAL)'; then
    ```
5. 5小时限制
    1) 这是否能够通用的分析出不同模型返回的5小时限制：if grep -qi "5.*hour.*limit\|limit.*reached.*try.*back\|usage.*limit.*reached" "$output_file"; then
    2) 每隔一秒打印一次，是否合适？printf "\r${YELLOW}Time until retry: %02d:%02d${NC}" $minutes $seconds
    3) 能否每隔X秒后，试探是否限制解除，如果解除那么就不要继续循环了
6. `ralph_import.sh`里面要求生成的`@fix_plan.md`需要加上测试任务，否则生成的代码运行起来有问题，关键字`cat > "$CONVERSION_PROMPT_FILE" << 'PROMPTEOF'`，生成的时候会把需求文件放到提示词中。
7. `--output-format json`。
8. `normalized_file=$(mktemp)` 创建临时目录


## bjarne可能要改的地方
1. 所有用到的`/tmp`的地方，是否能够替换成`mktemp`。
2. `DETECTED=""`，检测`Java`和`SpringBoot`是不是要更加优化一些。
3. `EXISTING SOURCE FILES (explore these to understand what's built):` 引用的`SRC_FILES`是否会上传过多的文件？
4. INNER_RUN_CLAUDE_FIRST_RUN=true，batch批量的时候可能有问题。


## 我的Ralph循环脚本，需要继承的好的地方

1. 创建本地git仓库，跟踪代码改动。还有一种解法就是`git rev-parse --git-dir`获得子目录所在git仓库的根目录。要PK一下。
    ```shell
    git init
    echo "# $PROJECT_NAME" > README.md
    git add .
    git commit -m "Initial Ralph project setup"
    ```
2. 断路器设计
3. 日志输出设计
4. bjarne的各个阶段提示词独立出模板，，里面指定代码生成位置
5. ralph-claude-code调用claude的重要点：
    1) build_loop_context里面根据上一个循环的状态，动态生成当前上下文，但是它里面没有添加任务内容，需要确认bjarne里面是怎么做的
    2) loop_context通过--append-system-prompt传递给claude-code
    3) 提示词直接传给claude-code
    4) 是否复用claude-code的session的设计
        ```
        if [[ "$CLAUDE_USE_CONTINUE" == "true" ]]; then
            CLAUDE_CMD_ARGS+=("--continue")
        fi
        ```
    5) 设置了-p命令
    6) 设置了--allowedTools，不设置这个参数意味着允许所有工具，暂时先不要设置
6. 新会话的创建和使用老会话
    1) 新会话的创建：claude -p --session-id D97F58A1-FAD5-44F8-BE39-C19563E72D31 "你记得,你叫ABC"
    2) 使用老会话：claude -p -r D97F58A1-FAD5-44F8-BE39-C19563E72D31 "你叫什么名字？"
